{{range ls "published"}}{{with $d := .Value | parseJSON}}{{if $d}}
server {
    listen 80;
    server_name {{$d.hostname}};

    resolver 127.0.0.1;
    set $backend_upstream "http://{{$d.service}}.service.consul:{{$d.port}}";

    location / {
        proxy_pass $backend_upstream;
    }
}
{{end}}{{end}}{{end}}



server {
    listen 80 default;
    server_name www.cloudkeeper.io;

    location / {
        proxy_pass http://www.adamkdean.co.uk;
    }
}
